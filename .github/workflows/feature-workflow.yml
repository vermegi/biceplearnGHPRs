name: feature-workflow

on: 
  push:
    branches: 
      - feature/*
    
env: 
    AZURE_RESOURCEGROUP_NAME: ToyWebsiteTest
    ENVIRONMENT_TYPE: Test

jobs:
  lint: 
     uses: vermegi/biceplearnGHPRs/.github/workflows/lint.yml@main

  createRG: 
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - uses: azure/login@v1
        name: Sign in to Azure
        with:
          creds: ${{ secrets.AZURE_CREDENTIALS }}    
      - name: get resource group name
        id: rgName
        run: |
         echo "github ref_name: ${{ github.ref }}"
         export thestring=${{ github.ref }}
         IFS='/' read -ra my_array <<< "$thestring"
         echo ${my_array[4]}
         echo "my_array: " ${my_array[4]}
         export featurebranch=${my_array[4]}
         echo "feature: " $featurebranch
         export rgname=rg_f_$featurebranch
         echo $rgname
         echo "::set-output name=rgname::$rgname"  
      - uses: Azure/cli@v1
        name: Create resource group
        with: 
          inlineScript: az group create -n ${{steps.rgName.outputs.rgname}} -l westeurope

